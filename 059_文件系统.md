### 文件系统

#### 为什么要引入文件系统

为了让程序在多次运行之间保留数据，必须将数据保存到文件中（通常存储在计算机磁盘上），保存后的数据可在后续时间检索使用。

<img src="C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20251025144100696.png" alt="image-20251025144100696" style="zoom:50%;" />

#### 程序使用文件的三步流程

- 打开文件：建立程序与文件的连接。
- 处理文件：对文件中的数据进行读取、分析等操作。
- 关闭文件：断开程序与文件的连接，释放资源。

#### 文件的类型和访问流程

##### 文件类型

- **文本文件**：包含已编码为文本的数据，如`.txt`、`.py`文件。
- **二进制文件**：包含未转换为文本的数据，如图片、音频、可执行文件等。

##### 文件访问方法

- **顺序访问**：从文件开头到结尾依次读取，不能跳过前面内容直接访问后续数据。
- **直接访问**：可直接跳转到文件中的任意数据位置进行访问。

#### 文件对象

是与特定文件关联的对象，为程序操作文件提供途径，可通过变量引用文件对象来实现对文件的读写等操作。

<img src="C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20251025145117982.png" alt="image-20251025145117982" style="zoom:50%;" />

##### open 函数

你必须先用Python内置的open()函数打开一个文件，创建一个file对象，相关的方法才可以调用它进行读写。

```python
file_object = open(file_name [, access_mode][, buffering])
```

- **file_name：**file_name变量是一个包含了你要访问的文件名称/路径的字符串值。

  - 默认文件位置

    - 若`open`函数接收的文件名不含路径，会假设文件与程序在同一目录下；程序运行时创建的文件也会默认在程序所在目录。

  - 自定义路径的设置

    可在`open`函数参数中指定替代路径和文件名，路径字符串字面量需以字母`r`为前缀（用于处理路径中的特殊字符，如反斜杠`r\C:\user\pwd.txt`）。

- **access_mode：**access_mode决定了打开文件的模式：只读，写入，追加等。所有可取值见如下的完全列表。这个参数是非强制的，默认文件访问模式为只读(r)。

  | 模式 | 描述                                                         |
  | :--- | :----------------------------------------------------------- |
  | t    | 文本模式 (默认)。                                            |
  | x    | 写模式，新建一个文件，如果该文件已存在则会报错。             |
  | b    | 二进制模式。                                                 |
  | +    | 打开一个文件进行更新(可读可写)。                             |
  | U    | 通用换行模式（不推荐）。                                     |
  | r    | 以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。 |
  | rb   | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。 |
  | r+   | 打开一个文件用于读写。文件指针将会放在文件的开头。           |
  | rb+  | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。 |
  | w    | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
  | wb   | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |
  | w+   | 打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
  | wb+  | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |
  | a    | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
  | ab   | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
  | a+   | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |
  | ab+  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |

  <img src="https://www.runoob.com/wp-content/uploads/2013/11/2112205-861c05b2bdbc9c28.png" alt="img" style="zoom:50%;" />

- **buffering:** 如果buffering的值被设为0，就不会有寄存。如果buffering的值取1，访问文件时会寄存行。如果将buffering的值设为大于1的整数，表明了这就是的寄存区的缓冲大小。如果取负值，寄存区的缓冲大小则为系统默认。

##### write()方法

write()方法可将任何字符串写入一个打开的文件。需要重点注意的是，Python字符串可以是二进制数据，而不是仅仅是文字。

write()方法不会在字符串的结尾添加换行符('\n')：

```python
fileObject.write(string)
```

如果需要进行换行，可以使用如下代码

```python
fileObject.write(string + '\n')
```

###### w模式打开的文件和a模式打开的文件之间的区别

- `'w' `模式的特点

  以`'w'`模式打开文件时，若文件已存在会被覆盖。

- 'a' 模式的作用

  要向文件追加数据需使用`'a'`

  模式：

  - 若文件存在，不会被清空；若文件不存在，则创建新文件。
  - 数据会被写入到文件现有内容的末尾。

##### close()方法

File 对象的 close（）方法刷新缓冲区里任何还没写入的信息，并关闭该文件，这之后便不能再进行写入。当一个文件对象的引用被重新指定给另一个文件时，Python 会关闭之前的文件。用 close（）方法关闭文件是一个很好的习惯。

```python
fileObject.close()
```

##### 读取文件

###### read 方法

是文件对象的方法，用于将整个文件内容读取到内存中，仅在文件以读取模式打开时有效，返回的内容为字符串类型。

###### readline 方法

是文件对象的方法，用于从文件中读取一行，返回的行以字符串形式呈现，包含换行符`'\n'`，如果需要去除换行符可以使用如下代码：

```python
line = line.rstrip('\n')
```

###### 读取位置（Read position）

标记文件中下一个要读取项的位置，用于控制文件读取的进度。

#### 数值读写

##### 数值写入文件的要求

向文件写入数值前，必须将其转换为字符串，可使用`str`函数实现转换，`str(123)`会将整数 `123 `转换为字符串`'123'`

##### 数值从文件读取的处理

从文本文件读取的数值是以字符串形式存在的，若要进行数学运算，需将其转换为数值类型：

- 整数转换使用`int`函数，如`int('123')`得到 123。
- 浮点数转换使用`float`函数，如`float('3.14')`得到 3.14。

#### 通过循环读取文件内容

文件通常用于存储大量数据，因此需要用循环来批量读取或写入数据。当文件中数据项的数量未知时，可利用 `readline` 方法的特性 —— 当读取到文件末尾时，会返回空字符串 `''`。我们可以将空字符串作为 “哨兵”，用 `while` 循环来持续读取，直到遇到空字符串为止。

```python
# 使用with语句打开文件，无需手动close
with open('data.txt', 'r') as file:
    line = file.readline()
    while line != '':
        processed_line = line.rstrip('\n')
        print(processed_line)
        line = file.readline()
```

<img src="C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20251025161742187.png" alt="image-20251025161742187" style="zoom:50%;" />

Python 支持通过`for`循环自动逐行读取文件内容，当读取到文件末尾时会自动终止循环。循环会对文件中的每一行迭代一次，无需手动判断文件末尾，简化了文件读取的代码逻辑。

```python
# 打开文件
with open('data.txt', 'r') as file:
    # 使用for循环逐行读取文件
    for line in file:
        # 去除换行符并处理当前行（如打印）
        processed_line = line.rstrip('\n')
        print(processed_line)
```

#### with 语句的作用

`with`语句用于打开文件并自动关闭文件，无需手动调用`close()`方法，保证文件资源的合理释放。

格式为

```python
with open(filename, mode) as file_variable:
```

，其中：

- `filename`：指定文件名的字符串。
- `mode`：指定文件打开模式的字符串，如`'r'`（读）、`'w'`（写）、`'a'`（追加）。
- `file_variable`：引用文件对象的变量名。
- 缩进的语句块称为`with`套件（with suite），在其中执行文件操作。

可以通过如下格式打开两个文件:

```python
with open('file1.txt', 'r') as input_file, open('file2.txt', 'w') as output_file:
```
