### 异常

#### 异常与回溯

- **异常（Exception）**：程序运行时发生的错误，通常会导致程序突然终止。
- **回溯（Traceback）**：给出导致异常的行号等信息的错误消息，会指明异常类型和引发异常的错误的简要描述。

```python
# 示例：除以零异常
num = 10 / 0
```

运行上述代码会触发`ZeroDivisionError`异常，Python 会输出回溯信息，包含错误类型、发生错误的行号及错误描述，例如：

```
Traceback (most recent call last):
  File "example.py", line 2, in <module>
    num = 10 / 0
ZeroDivisionError: division by zero
```

这种机制的作用是帮助开发者定位和排查程序运行时的错误，是 Python 错误处理体系的基础部分。

#### **try/except 异常处理逻辑**

##### 异常触发时的处理逻辑

- 若 try 套件中的语句触发了 except 子句指定的异常：
  - 执行 except 子句后的异常处理代码（handler）。
  - 程序继续执行 try/except 语句之后的代码。
- 若触发了其他未指定的异常：
  - 程序会终止并输出回溯错误信息。

##### 无异常时的处理逻辑

若 try 套件中未触发任何异常，except 子句的处理代码会被跳过，程序直接执行 try/except 之后的代码。

##### **多类型异常的处理**

try 套件中的代码常可能触发多种类型的异常，需为每种需要处理的异常编写对应的 except 子句。不指定具体异常的 except 子句可处理 try 套件中触发的任何异常，该子句应始终放在一系列 except 子句的最后。

```python
try:
    # 可能触发多种异常的代码
    num = int(input("请输入一个整数："))
    result = 10 / num
    print(f"计算结果：{result}")
except ZeroDivisionError:
    # 处理除以零异常
    print("错误：不能除以零！")
except ValueError:
    # 处理值类型异常
    print("错误：请输入有效的整数！")
except:
    # 处理其他所有未指定的异常（应放在最后）
    print("发生了未知错误！")

print("程序执行完毕。")
```

##### 异常信息显示

- **异常对象（Exception object）**：当异常被抛出时在内存中创建的对象，通常包含与该异常相关的默认错误消息。

- **异常对象的赋值与使用**：可在 except 子句中将异常对象赋值给一个变量，例如`except ValueError as err:`，然后可将该变量传递给 print 函数以显示默认错误消息。

```python
try:
    # 尝试将非整数转换为int，触发ValueError
    num = int("abc")
except ValueError as err:
    # 输出异常对象的默认错误消息
    print(err)
```

运行上述代码会输出`invalid literal for int() with base 10: 'abc'`，这是`ValueError`异常对象的默认错误描述。

#### else 套件的定义与位置

- `else`套件（缩进的语句块）会在`try`套件中的语句**未触发任何异常**时执行。
- 若`try`套件中触发了异常，`else`套件会被跳过。

```python
try:
    num = int(input("请输入一个正整数："))
    if num <= 0:
        raise ValueError("输入必须是正整数")
except ValueError as err:
    print(err)
else:
    # 仅当try套件无异常时执行
    print(f"您输入的数是：{num}")
```

- 若输入`5`（无异常），执行`else`套件，输出`您输入的数是：5`。
- 若输入`-3`（触发 ValueError），执行`except`子句，输出`输入必须是正整数`，`else`套件被跳过。
- 若输入`abc`（触发 ValueError），执行`except`子句，输出默认错误消息，`else`套件被跳过。

####  finally 套件的执行逻辑

- `finally`套件（缩进的语句块）**无论是否触发异常**都会执行。
- 主要用途是在程序退出前执行 “清理操作”（如关闭文件、释放资源等）。

```python
try:
    file = open('data.txt', 'r')
    # 尝试读取并处理文件（可能触发异常）
    content = file.read()
    print(content)
except FileNotFoundError:
    print("错误：文件不存在！")
finally:
    # 无论是否触发异常，都会执行关闭文件操作
    if 'file' in locals() and file:
        file.close()
    print("文件资源已释放。")
```

- 若文件存在且读取正常，执行`try`套件后，进入`finally`套件关闭文件并打印提示。
- 若文件不存在，触发`FileNotFoundError`，执行`except`子句后，仍会进入`finally`套件执行清理操作。

#### 未处理异常

##### 异常未被处理的两种情况

- 没有指定对应异常类型的`except`子句。
- 异常在`try`套件之外被触发。

##### 未处理异常的影响

在上述两种情况下，异常会导致程序终止。Python 文档会提供不同函数可能触发的异常信息，以帮助开发者提前识别和处理潜在异常。
